{% extends "layout.html" %}
{% block title %}Sales{% endblock %}

{% block content %}
<div class="container my-4">

    <h2 class="mb-4">
        ðŸ›’ Sales (POS)
    </h2>

    <div class="row">

        <!-- LEFT: BOOK LIST -->
        <div class="col-md-7">
            <h4 class="mb-3">Books</h4>

            <table class="table table-dark table-striped align-middle">
                <tr>
                    <th>Cover</th>
                    <th>Title</th>
                    <th>Price</th>
                    <th></th>
                </tr>

                {% for book in books %}
                <tr>
                    <td>
                        {% if book.cover %}
                        <img src="{{ book.cover.url }}" 
                             style="height: 70px; width: 50px; object-fit: cover; border-radius: 4px;">
                        {% else %}
                        <div style="height:70px;width:50px;background:#444;border-radius:4px;"></div>
                        {% endif %}
                    </td>

                    <td>{{ book.title }}</td>
                    <td>â‚¹ {{ book.price }}</td>

                    <td>
                        {% if book.stock > 0 %}
                            <a href="{% url 'add_to_cart' book.id %}" class="btn btn-success btn-sm">Add</a>
                            <div class="small text-muted">Stock: {{ book.stock }}</div>
                        {% else %}
                            <span class="badge bg-danger">Out of Stock</span>
                        {% endif %}

                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- RIGHT: CART -->
        <div class="col-md-5">
            <h4 class="mb-3">Cart</h4>

            <table class="table table-dark table-striped align-middle">
                <tr>
                    <th>Cover</th>
                    <th>Book</th>
                    <th>Qty</th>
                    <th>Subtotal</th>
                    <th></th>
                </tr>

                {% for item in cart %}
                <tr>
                    <td>
                        {% if item.book.cover %}
                        <img src="{{ item.book.cover.url }}" 
                             style="height: 60px; width: 45px; object-fit: cover; border-radius: 4px;">
                        {% else %}
                        <div style="height:60px;width:45px;background:#555;border-radius:4px;"></div>
                        {% endif %}
                    </td>

                    <td>{{ item.book.title }}</td>
                    <td>{{ item.qty }}</td>
                    <td>â‚¹ {{ item.subtotal }}</td>

                    <td>
                        <a href="{% url 'remove_from_cart' item.book.id %}" 
                           class="btn btn-danger btn-sm">
                           X
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </table>

            <h3 class="mt-3">Total: â‚¹ {{ total }}</h3>

            <a href="{% url 'checkout' %}" 
               class="btn btn-primary mt-3"
               {% if total == 0 %} disabled {% endif %}>
               Checkout
            </a>
        </div>

    </div>
</div>
{% endblock %}
